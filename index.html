<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Wishlist</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f4f4f4; }
        h1 { text-align: center; }
        .item-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .item { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; cursor: pointer; transition: 0.2s; }
        .item:hover { transform: translateY(-3px); }
        .item img { max-width: 100%; height: 150px; object-fit: contain; }
        .item.sold-out { opacity: 0.5; pointer-events: none; filter: grayscale(100%); position: relative; }
        .item.sold-out::after { content: "ALREADY BOUGHT"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: red; color: white; padding: 5px 10px; font-weight: bold; transform: translate(-50%, -50%) rotate(-10deg); }
        
        /* Modal (Menu) Styles */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 8px; width: 90%; max-width: 400px; text-align: center; }
        .btn { display: block; width: 100%; padding: 10px; margin: 10px 0; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn-buy { background: #28a745; color: white; text-decoration: none; }
        .btn-confirm { background: #007bff; color: white; }
        .btn-close { background: #ccc; }
    </style>
</head>
<body>

    <h1>üéÅ My Wishlist</h1>
    <div id="loading">Loading items...</div>
    <div class="item-list" id="itemList"></div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Item Name</h2>
            <div id="modalOptions"></div>
            <p>Did you buy this?</p>
            <button class="btn btn-confirm" id="confirmBtn">Yes, mark as bought!</button>
            <button class="btn btn-close" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- PASTE YOUR FIREBASE CONFIG HERE ---
        const firebaseConfig = {
  apiKey: "AIzaSyB8JqyAMFuZiI6lCkxkJeM4Voa_JhxrU5s",
  authDomain: "wishlist-db-6c902.firebaseapp.com",
  databaseURL: "https://wishlist-db-6c902-default-rtdb.firebaseio.com",
  projectId: "wishlist-db-6c902",
  storageBucket: "wishlist-db-6c902.firebasestorage.app",
  messagingSenderId: "19062302614",
  appId: "1:19062302614:web:5e0112d8f63ccc4550dfb7",
  measurementId: "G-FGYFJN68F3"
        };
        // ---------------------------------------

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- YOUR WISHLIST ITEMS DATA ---
        // You only need to edit this list once to set up your items.
        // If an item has 'options', clicking it shows a menu.
        // If 'bought' is true, it stays grayed out.
        const defaultItems = {
            "item1": { name: "Espresso Machine", image: "https://via.placeholder.com/150?text=Coffee", link: "https://amazon.com/example", bought: false },
            "item2": { name: "Cool T-Shirt", image: "https://via.placeholder.com/150?text=Shirt", link: "https://store.com/shirt", options: ["Size M", "Size L"], bought: false },
            "item3": { name: "Gaming Mouse", image: "https://via.placeholder.com/150?text=Mouse", link: "https://bestbuy.com/mouse", bought: false }
        };

        const itemListEl = document.getElementById('itemList');
        const modal = document.getElementById('modal');
        let currentItemId = null;

        // 1. LISTEN TO DATABASE
        // This runs every time the database changes (real-time!)
        const itemsRef = ref(db, 'items');
        onValue(itemsRef, (snapshot) => {
            document.getElementById('loading').style.display = 'none';
            const data = snapshot.val() || defaultItems; // Use default if DB is empty
            
            // If DB is empty, initialize it with defaults
            if (!snapshot.val()) {
                update(ref(db), { items: defaultItems });
            }

            renderItems(data);
        });

        // 2. RENDER THE LIST
        function renderItems(items) {
            itemListEl.innerHTML = '';
            for (const [id, item] of Object.entries(items)) {
                const div = document.createElement('div');
                div.className = `item ${item.bought ? 'sold-out' : ''}`;
                div.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <h3>${item.name}</h3>
                `;
                div.onclick = () => {
                    if (!item.bought) openModal(id, item);
                };
                itemListEl.appendChild(div);
            }
        }

        // 3. HANDLE CLICKS
        window.openModal = function(id, item) {
            currentItemId = id;
            document.getElementById('modalTitle').innerText = item.name;
            const optionsDiv = document.getElementById('modalOptions');
            optionsDiv.innerHTML = '';

            // If there are options (Size/Color), show them
            if (item.options) {
                item.options.forEach(opt => {
                    optionsDiv.innerHTML += `<a href="${item.link}" target="_blank" class="btn btn-buy">Buy ${opt}</a>`;
                });
            } else {
                // Direct buy link
                optionsDiv.innerHTML = `<a href="${item.link}" target="_blank" class="btn btn-buy">Go to Store</a>`;
            }
            
            modal.style.display = 'flex';
        }

        window.closeModal = function() {
            modal.style.display = 'none';
        }

        // 4. MARK AS BOUGHT
        document.getElementById('confirmBtn').onclick = () => {
            if (currentItemId) {
                // Update Firebase
                update(ref(db, 'items/' + currentItemId), { bought: true });
                
                // Send Notification (Using simple Mailto for now)
                const subject = "I bought you a gift!";
                const body = `Hey! I just bought the ${document.getElementById('modalTitle').innerText} from your list.`;
                window.open(`mailto:YOUR_EMAIL@HERE.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
                
                closeModal();
            }
        }
        
        // Close modal if clicking outside
        window.onclick = function(event) {
            if (event.target == modal) closeModal();
        }
    </script>
</body>
  </html>
